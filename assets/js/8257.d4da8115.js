"use strict";(self.webpackChunknew_website=self.webpackChunknew_website||[]).push([[8257],{28257:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var a=n(58168),o=(n(96540),n(15680));const i={title:"Announcing Disjoint Unions","short-title":"Disjoint Unions",author:"Avik Chaudhuri",hide_table_of_contents:!0},r=void 0,s={permalink:"/blog/2015/07/03/Disjoint-Unions",source:"@site/blog/2015-07-03-Disjoint-Unions.md",title:"Announcing Disjoint Unions",description:"Sometimes programs need to deal with different kinds of data all at once, where the shape of the data can be different based on what kind of data the code is looking at. This kind of programming is so common in functional programming languages that almost all such languages come with a way of:",date:"2015-07-03T00:00:00.000Z",formattedDate:"July 3, 2015",tags:[],hasTruncateMarker:!0,authors:[{name:"Avik Chaudhuri"}],frontMatter:{title:"Announcing Disjoint Unions","short-title":"Disjoint Unions",author:"Avik Chaudhuri",hide_table_of_contents:!0},prevItem:{title:"Version-0.14.0",permalink:"/blog/2015/07/29/Version-0.14.0"},nextItem:{title:"Announcing Bounded Polymorphism",permalink:"/blog/2015/03/12/Bounded-Polymorphism"}},l={authorsImageUrls:[void 0]},d=[{value:"The problem",id:"the-problem",level:2},{value:"The solution",id:"the-solution",level:2},{value:"Why we built this",id:"why-we-built-this",level:2}],p={toc:d};function m(e){let{components:t,...n}=e;return(0,o.mdx)("wrapper",(0,a.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,"Sometimes programs need to deal with different kinds of data all at once, where the shape of the data can be different based on what kind of data the code is looking at. This kind of programming is so common in functional programming languages that almost all such languages come with a way of:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Specifying such data by a set of disjoint cases, distinguished by \u201ctags\u201d, where each tag is associated with a different \u201crecord\u201d of properties. (These descriptions are called \u201cdisjoint union\u201d or \u201cvariant\u201d types.)"),(0,o.mdx)("li",{parentName:"ul"},"Doing case analysis on such data, by checking tags and then directly accessing the associated record of properties. (The common way to do such case analysis is by pattern matching.)")),(0,o.mdx)("p",null,"Examples of programs that analyze or transform such data range from compilers working with abstract syntax trees, to operations that may return exceptional values,  with much more in between!"),(0,o.mdx)("p",null,'As of Flow 0.13.1 it is now possible to program in this style in JavaScript in a type-safe manner. You can define a disjoint union of object types and do case analysis on objects of that type by switching on the value of some common property (called a "sentinel") in those object types.'),(0,o.mdx)("p",null,"Flow's syntax for disjoint unions looks like:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},'type BinaryTree =\n  { kind: "leaf", value: number } |\n  { kind: "branch", left: BinaryTree, right: BinaryTree }\n\nfunction sumLeaves(tree: BinaryTree): number {\n  if (tree.kind === "leaf") {\n    return tree.value;\n  } else {\n    return sumLeaves(tree.left) + sumLeaves(tree.right);\n  }\n}\n')),(0,o.mdx)("h2",{id:"the-problem"},"The problem"),(0,o.mdx)("p",null,"Consider the following function that returns different objects depending on the data passed into it:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},"type Result = { status: string, errorCode?: number }\n\nfunction getResult(op): Result {\n  var statusCode = op();\n  if (statusCode === 0) {\n    return { status: 'done' };\n  } else {\n    return { status: 'error', errorCode: statusCode };\n  }\n}\n")),(0,o.mdx)("p",null,"The result contains a ",(0,o.mdx)("inlineCode",{parentName:"p"},"status")," property that is either ",(0,o.mdx)("inlineCode",{parentName:"p"},"'done'")," or ",(0,o.mdx)("inlineCode",{parentName:"p"},"'error'"),",\nand an optional ",(0,o.mdx)("inlineCode",{parentName:"p"},"errorCode")," property that holds a numeric status code when the\n",(0,o.mdx)("inlineCode",{parentName:"p"},"status")," is ",(0,o.mdx)("inlineCode",{parentName:"p"},"'error'"),"."),(0,o.mdx)("p",null,"One may now try to write another function that gets the error code from a result:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},"function getErrorCode(result: Result): number {\n  switch (result.status) {\n    case 'error':\n      return result.errorCode;\n    default:\n      return 0;\n  }\n}\n")),(0,o.mdx)("p",null,"Unfortunately, this code does not typecheck. The ",(0,o.mdx)("inlineCode",{parentName:"p"},"Result")," type does not precisely\ncapture the relationship between the ",(0,o.mdx)("inlineCode",{parentName:"p"},"status")," property and the ",(0,o.mdx)("inlineCode",{parentName:"p"},"errorCode")," property.\nNamely it doesn't capture that when the ",(0,o.mdx)("inlineCode",{parentName:"p"},"status")," property is ",(0,o.mdx)("inlineCode",{parentName:"p"},"'error'"),", the ",(0,o.mdx)("inlineCode",{parentName:"p"},"errorCode"),"\nproperty will be present and defined on the object. As a result, Flow thinks that\n",(0,o.mdx)("inlineCode",{parentName:"p"},"result.errorCode")," in the above function may return ",(0,o.mdx)("inlineCode",{parentName:"p"},"undefined")," instead of ",(0,o.mdx)("inlineCode",{parentName:"p"},"number"),"."),(0,o.mdx)("p",null,"Prior to version 0.13.1 there was no way to express this relationship, which meant\nthat it was not possible to check the type safety of this simple, familiar idiom!"),(0,o.mdx)("h2",{id:"the-solution"},"The solution"),(0,o.mdx)("p",null,"As of version 0.13.1 it is possible to write a more precise type for ",(0,o.mdx)("inlineCode",{parentName:"p"},"Result"),"\nthat better captures the intent and helps Flow narrow down the possible shapes\nof an object based on the outcome of a dynamic ",(0,o.mdx)("inlineCode",{parentName:"p"},"===")," check. Now, we can write:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javaScript"},"type Result = Done | Error\ntype Done = { status: 'done' }\ntype Error = { status: 'error', errorCode: number }\n")),(0,o.mdx)("p",null,"In other words, we can explicitly list out the possible shapes of results. These\ncases are distinguished by the value of the ",(0,o.mdx)("inlineCode",{parentName:"p"},"status")," property. Note that here\nwe use the string literal types ",(0,o.mdx)("inlineCode",{parentName:"p"},"'done'")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"'error'"),". These match exactly the strings\n",(0,o.mdx)("inlineCode",{parentName:"p"},"'done'")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"'error'"),", which means that ",(0,o.mdx)("inlineCode",{parentName:"p"},"===")," checks on those values are enough for\nFlow to narrow down the corresponding type cases. With this additional reasoning, the\nfunction ",(0,o.mdx)("inlineCode",{parentName:"p"},"getErrorCode")," now typechecks, without needing any changes to the code!"),(0,o.mdx)("p",null,"In addition to string literals, Flow also supports number literals as singleton types\nso they can also be used in disjoint unions and case analyses."),(0,o.mdx)("h2",{id:"why-we-built-this"},"Why we built this"),(0,o.mdx)("p",null,"Disjoint unions are at the heart of several good programming practices pervasive in functional programming languages. Supporting them in Flow means that JavaScript can use these practices in a type-safe manner. For example, disjoint unions can be used to write type-safe ",(0,o.mdx)("a",{parentName:"p",href:"https://facebook.github.io/flux/docs/dispatcher.html"},"Flux dispatchers"),". They are also heavily used in a recently released ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/graphql/graphql-js"},"reference implementation of GraphQL"),"."))}m.isMDXComponent=!0}}]);