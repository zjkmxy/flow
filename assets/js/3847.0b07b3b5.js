"use strict";(self.webpackChunknew_website=self.webpackChunknew_website||[]).push([[3847],{83847:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>m});var i=t(58168),s=(t(96540),t(15680));const a={title:"Version 0.21.0","short-title":"Version 0.21.0",author:"Gabe Levi",hide_table_of_contents:!0},o=void 0,r={permalink:"/blog/2016/02/02/Version-0.21.0",source:"@site/blog/2016-02-02-Version-0.21.0.md",title:"Version 0.21.0",description:"Yesterday we deployed Flow v0.21.0! As always, we've listed out the most",date:"2016-02-02T00:00:00.000Z",formattedDate:"February 2, 2016",tags:[],hasTruncateMarker:!0,authors:[{name:"Gabe Levi"}],frontMatter:{title:"Version 0.21.0","short-title":"Version 0.21.0",author:"Gabe Levi",hide_table_of_contents:!0},prevItem:{title:"New Implementation of Unions and Intersections",permalink:"/blog/2016/07/01/New-Unions-Intersections"},nextItem:{title:"Version-0.19.0",permalink:"/blog/2015/12/01/Version-0.19.0"}},l={authorsImageUrls:[void 0]},m=[{value:"JSX Intrinsics",id:"jsx-intrinsics",level:3},{value:"Example of how to use JSX intrinsics",id:"example-of-how-to-use-jsx-intrinsics",level:4},{value:"What is going on here?",id:"what-is-going-on-here",level:4},{value:"Smarter string refinements",id:"smarter-string-refinements",level:3},{value:"New string refinements",id:"new-string-refinements",level:4}],d={toc:m};function p(e){let{components:n,...t}=e;return(0,s.mdx)("wrapper",(0,i.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,s.mdx)("p",null,"Yesterday we deployed Flow v0.21.0! As always, we've listed out the most\ninteresting changes in the\n",(0,s.mdx)("a",{parentName:"p",href:"https://github.com/facebook/flow/blob/master/Changelog.md#v0210"},"Changelog"),".\nHowever, since I'm on a plane and can't sleep, I thought it might be fun to\ndive into a couple of the changes! Hope this blog post turns out interesting\nand legible!"),(0,s.mdx)("h3",{id:"jsx-intrinsics"},"JSX Intrinsics"),(0,s.mdx)("p",null,"If you're writing JSX, it's probably a mix of your own React Components and\nsome intrinsics. For example, you might write"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'render() {\n  return <div><FluffyBunny name="Fifi" /></div>;\n}\n')),(0,s.mdx)("p",null,"In this example, ",(0,s.mdx)("inlineCode",{parentName:"p"},"FluffyBunny")," is a React Component you wrote and ",(0,s.mdx)("inlineCode",{parentName:"p"},"div")," is a\nJSX intrinsic. Lower-cased JSX elements are assumed to be intrinsics by React\nand by Flow. Up until Flow v0.21.0, Flow ignored intrinsics and gave them the\ntype ",(0,s.mdx)("inlineCode",{parentName:"p"},"any"),". This meant Flow let you set any property on JSX intrinsics. Flow\nv0.21.0 will, by default, do the same thing as v0.20.0, However now you can\nalso configure Flow to properly type your JSX intrinsics!"),(0,s.mdx)("h4",{id:"example-of-how-to-use-jsx-intrinsics"},"Example of how to use JSX intrinsics"),(0,s.mdx)("p",null,".flowconfig"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},"[libs]\nmyLib.js\n")),(0,s.mdx)("p",null,"myLib.js"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'// JSXHelper is a type alias to make this example more concise.\n// There\'s nothing special or magic here.\n// JSXHelper<{name: string}> is a React component\n// with the single string property "name", which has a default\ntype JSXHelper<T> = Class<ReactComponent<T,T,mixed>>;\n\n// $JSXIntrinsics is special and magic.\n// This declares the types for `div` and `span`\ntype $JSXIntrinsics = {\n  div: JSXHelper<{id: string}>,\n  span: JSXHelper<{id: string, class: string}>,\n};\n')),(0,s.mdx)("p",null,"myCode.js"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},'<div id="asdf" />; // No error\n<div id={42} />; // Error: `id` prop is a string, not a number!\n')),(0,s.mdx)("h4",{id:"what-is-going-on-here"},"What is going on here?"),(0,s.mdx)("p",null,"The new bit of magic is this ",(0,s.mdx)("inlineCode",{parentName:"p"},"$JSXIntrinsics")," type alias. When Flow sees\n",(0,s.mdx)("inlineCode",{parentName:"p"},"<foo />")," it will look to see if ",(0,s.mdx)("inlineCode",{parentName:"p"},"$JSXIntrinsics")," exists and if so will grab\nthe type of ",(0,s.mdx)("inlineCode",{parentName:"p"},"$JSXIntrinsics['foo']"),". It will use this type to figure out which\nproperties are available and need to be set."),(0,s.mdx)("p",null,"We haven't hardcoded the intrinsics into Flow since the available intrinsics\nwill depend on your environment. For example, React native would have different\nintrinsics than React for the web would."),(0,s.mdx)("h3",{id:"smarter-string-refinements"},"Smarter string refinements"),(0,s.mdx)("p",null,"One of the main ways that we make Flow smarter is by teaching it to recognize\nmore ways that JavaScript programmers refine types. Here's an example of a\ncommon way to refine nullable values:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},"class Person {\n  name: ?string;\n  ...\n  getName(): string {\n    // Before the if, this.name could be null, undefined, or a string\n    if (this.name != null) {\n      // But now the programmer has refined this.name to definitely be a string\n      return this.name;\n    }\n    // And now we know that this.name is null or undefined.\n    return 'You know who';\n  }\n}\n")),(0,s.mdx)("h4",{id:"new-string-refinements"},"New string refinements"),(0,s.mdx)("p",null,"In v0.21.0, one of the refinements we added is the ability to refine types by\ncomparing them to strings."),(0,s.mdx)("p",null,"This is useful for refining unions of string literals into string literals"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},"function test(x: 'foo' | 'bar'): 'foo' {\n  if (x === 'foo') {\n    // Now Flow understands that x has the type 'foo'\n    return x;\n  } else {\n    return 'foo';\n  }\n}\n")),(0,s.mdx)("p",null,"And can also narrow the value of strings:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-js"},"function test(x: string): 'foo' {\n  if (x === 'foo') {\n    // Now Flow knows x has the type 'foo'\n    return x;\n  } else {\n    return 'foo';\n  }\n}\n")),(0,s.mdx)("p",null,"This is one of the many refinements that Flow currently can recognize and\nfollow, and we'll keep adding more! Stay tuned!"))}p.isMDXComponent=!0}}]);